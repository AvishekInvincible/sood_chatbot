<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>SOOD - AI Assistant</title>

    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>

        :root {

            --bg-color: #ffffff;

            --text-primary: #333333;

            --text-secondary: #666666;

            --accent-color: #2D7FF9;

            --card-bg: #f8f9fa;

            --border-radius: 24px;

            --transition: all 0.3s ease;

            --bg-secondary: #f7f7f7;

            --border-color: #ddd;

        }



        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

            font-family: 'Space Grotesk', sans-serif;

        }



        body {

            background: var(--bg-color);

            color: var(--text-primary);

            line-height: 1.6;

            -webkit-font-smoothing: antialiased;

        }



        .main-title {

            text-align: center;

            font-size: 5rem;

            font-weight: 700;

            margin: 2rem 0;

            background: linear-gradient(45deg, #FF0000, #FF7F00, #FFFF00, #00FF00, #0000FF, #4B0082, #8F00FF);

            -webkit-background-clip: text;

            background-clip: text;

            color: transparent;

            animation: gradient 10s ease infinite;

            background-size: 400% 400%;

        }



        @keyframes gradient {

            0% { background-position: 0% 50%; }

            50% { background-position: 100% 50%; }

            100% { background-position: 0% 50%; }

        }



        .container {

            max-width: 1200px;

            margin: 0 auto;

            padding: 20px;

            min-height: 100vh;

            display: flex;

            flex-direction: column;

        }



        .chat-container {

            flex: 1;

            display: flex;

            flex-direction: column;

            gap: 1rem;

            overflow-y: auto;

            padding: 1rem;

            margin-bottom: 2rem;

            background: var(--card-bg);

            border-radius: var(--border-radius);

            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);

        }



        .message {

            max-width: 80%;

            padding: 1rem 1.5rem;

            border-radius: 18px;

            background: white;

            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);

            transition: var(--transition);

            animation: slideIn 0.3s ease-out;

        }



        .message:hover {

            transform: translateY(-2px);

            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);

        }



        .user-message {

            margin-left: auto;

            background: var(--accent-color);

            color: white;

        }



        .bot-message {

            margin-right: auto;

            background: white;

        }



        .error-message {

            margin: auto;

            background: #ff4444;

            color: white;

        }



        @keyframes slideIn {

            from {

                opacity: 0;

                transform: translateY(10px);

            }

            to {

                opacity: 1;

                transform: translateY(0);

            }

        }



        .input-container {

            display: flex;

            align-items: center;

            gap: 1rem;

            padding: 1.5rem;

            background: var(--card-bg);

            border-radius: var(--border-radius);

            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);

        }



        .input-field {

            flex: 1;

            padding: 0.75rem 1rem;

            border: 2px solid var(--border-color);

            border-radius: var(--border-radius);

            font-family: inherit;

            font-size: 1rem;

            background: white;

            transition: var(--transition);

            width: 100%;

        }



        .input-field:focus {

            outline: none;

            border-color: var(--accent-color);

            box-shadow: 0 0 0 2px rgba(var(--accent-rgb), 0.1);

        }



        .advanced-settings {

            margin-top: 10px;

            padding: 10px;

            border-top: 1px solid var(--border-color);

        }



        .advanced-settings-header {

            display: flex;

            align-items: center;

            gap: 8px;

            cursor: pointer;

            color: var(--text-secondary);

            font-size: 0.9rem;

        }



        .advanced-settings-content {

            display: none;

            padding-top: 10px;

        }



        .advanced-settings-content.show {

            display: block;

        }



        .tts-toggle {

            display: flex;

            align-items: center;

            gap: 8px;

            margin-top: 10px;

        }



        .switch {

            position: relative;

            display: inline-block;

            width: 50px;

            height: 26px;

        }



        .switch input {

            opacity: 0;

            width: 0;

            height: 0;

        }



        .slider {

            position: absolute;

            cursor: pointer;

            top: 0;

            left: 0;

            right: 0;

            bottom: 0;

            background-color: #ccc;

            transition: .4s;

            border-radius: 34px;

        }



        .slider:before {

            position: absolute;

            content: "";

            height: 20px;

            width: 20px;

            left: 3px;

            bottom: 3px;

            background-color: white;

            transition: .4s;

            border-radius: 50%;

        }



        input:checked + .slider {

            background-color: var(--accent-color);

        }



        input:checked + .slider:before {

            transform: translateX(24px);

        }



        footer {

            text-align: center;

            padding: 20px;

            color: var(--text-secondary);

            font-size: 0.9rem;

            border-top: 1px solid var(--border-color);

            margin-top: 20px;

        }



        .header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 2rem;

            padding: 1.5rem;

            background: var(--card-bg);

            border-radius: var(--border-radius);

            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);

        }



        .controls {

            display: flex;

            gap: 1.5rem;

            flex-wrap: wrap;

            justify-content: center;

            padding: 1rem;

        }



        .preset-templates {

            display: grid;

            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));

            gap: 1rem;

            margin-bottom: 2rem;

        }



        .preset-card {

            padding: 1rem;

            background: var(--card-bg);

            border-radius: var(--border-radius);

            cursor: pointer;

            transition: var(--transition);

            text-align: center;

            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);

        }



        .preset-card:hover {

            transform: translateY(-2px);

            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);

        }



        .input-container button {

            padding: 0.75rem;

            border: none;

            border-radius: 50%;

            background: white;

            color: var(--accent-color);

            cursor: pointer;

            transition: var(--transition);

            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);

            display: flex;

            align-items: center;

            justify-content: center;

        }



        .input-container button:hover {

            transform: translateY(-2px);

            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);

        }



        .input-container button svg {

            width: 24px;

            height: 24px;

        }



        .typing-indicator {

            display: flex;

            gap: 0.5rem;

            padding: 1rem;

            align-items: center;

        }



        .typing-dot {

            width: 8px;

            height: 8px;

            background: var(--accent-color);

            border-radius: 50%;

            animation: bounce 1.4s infinite;

        }



        .typing-dot:nth-child(2) { animation-delay: 0.2s; }

        .typing-dot:nth-child(3) { animation-delay: 0.4s; }



        @keyframes bounce {

            0%, 60%, 100% { transform: translateY(0); }

            30% { transform: translateY(-4px); }

        }



        .record-button {

            color: #ff4444 !important;

        }



        .record-button.recording {

            background: #ff4444 !important;

            color: white !important;

        }



        .stop-button {

            background: #ff4444 !important;

            color: white !important;

        }



        /* Enhanced Dropdown Styling */

        select {

            appearance: none;

            -webkit-appearance: none;

            -moz-appearance: none;

            padding: 12px 40px 12px 16px;

            font-size: 1rem;

            font-family: 'Space Grotesk', sans-serif;

            color: var(--text-primary);

            background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%232D7FF9' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E") no-repeat;

            background-position: right 12px center;

            background-size: 16px;

            border: 2px solid transparent;

            border-radius: var(--border-radius);

            cursor: pointer;

            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);

            transition: var(--transition);

            min-width: 240px;

        }



        select:hover {

            transform: translateY(-2px);

            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);

            border-color: var(--accent-color);

        }



        select:focus {

            outline: none;

            border-color: var(--accent-color);

            box-shadow: 0 0 0 3px rgba(45, 127, 249, 0.1);

        }



        select option {

            padding: 12px;

            font-size: 1rem;

            background: white;

            color: var(--text-primary);

        }



        /* Dropdown Container */

        .dropdown-group {

            position: relative;

            display: flex;

            flex-direction: column;

            gap: 0.5rem;

        }



        .dropdown-group label {

            font-size: 0.9rem;

            font-weight: 500;

            color: var(--text-secondary);

            margin-left: 4px;

        }



        /* Audio Control Button */

        .stop-audio-button {

            display: flex;

            align-items: center;

            gap: 8px;

            padding: 12px 20px;

            background: #ff4444;

            color: white;

            border: none;

            border-radius: var(--border-radius);

            cursor: pointer;

            font-family: 'Space Grotesk', sans-serif;

            font-size: 1rem;

            transition: var(--transition);

            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

        }



        .stop-audio-button:hover {

            transform: translateY(-2px);

            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);

            background: #ff3333;

        }



        .stop-audio-button svg {

            width: 20px;

            height: 20px;

        }



        @media (max-width: 768px) {

            select {

                width: 100%;

                min-width: unset;

            }



            .controls {

                flex-direction: column;

                gap: 1rem;

            }

        }

    </style>

</head>

<body>

    <h1 class="main-title">SOOD - AI Assistant</h1>

    <div class="container">

        <div class="preset-templates">

            <div class="preset-card" onclick="selectPreset('lawyer')">

                <h3>Saul Goodman - Legal Expert</h3>

                <p>Better Call Saul for legal guidance!</p>

            </div>

            

        
        </div>



        <header class="header">

            <div class="controls">

                <div class="dropdown-group">

                    <label>Select AI Expert</label>

                    <select id="modelSelect">

                        <option value="llama-3.1-70b-versatile">Saul Goodman - Legal Expert</option>

                     

                    </select>

                </div>

                <div class="dropdown-group">

                    <label>Select Voice</label>

                    <select id="voiceSelect">

                        <option value="1SM7GgM6IMuvQlz2BwM3" data-gender="male">Mike (Male Voice)</option>

                        <option value="Xb7hH8MSUJpSbSDYk0k2" data-gender="female">Jaya (Female Voice)</option>

                    </select>

                </div>

            </div>

        </header>



        <div class="chat-container" id="chatContainer">

            <!-- Messages will be inserted here -->

        </div>



        <div class="input-container">

            <button class="record-button" id="recordButton">

                <svg viewBox="0 0 24 24" fill="currentColor">

                    <circle cx="12" cy="12" r="8"/>

                </svg>

            </button>

            <button class="stop-button" id="stopButton" style="display: none;">

                <svg viewBox="0 0 24 24" fill="currentColor">

                    <rect x="6" y="6" width="12" height="12"/>

                </svg>

            </button>

            <input type="text" class="input-field" id="messageInput" placeholder="Type your message...">

            <button id="sendButton">

                <svg viewBox="0 0 24 24" fill="currentColor">

                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>

                </svg>

            </button>

            <button id="stopAudioButton" class="stop-audio-button" style="display: none;">

                <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">

                    <path d="M6 6h12v12H6z"/>

                </svg>

                Stop Audio

            </button>

        </div>



        <!-- Advanced Settings -->

        <div class="advanced-settings">

            <div class="advanced-settings-header">

                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">

                    <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>

                </svg>

                Advanced Settings

            </div>

            <div class="advanced-settings-content">

                <div class="tts-toggle">

                    <label class="switch">

                        <input type="checkbox" id="ttsToggle" checked>

                        <span class="slider"></span>

                    </label>

                    <label>Text-to-Speech</label>

                </div>

            </div>

        </div>



        <!-- Footer -->

        <footer>

            Created by Avishek  2024 | All rights reserved

        </footer>

    </div>



    <script>

        let mediaRecorder;

        let audioChunks = [];

        let isRecording = false;

        let currentAudio = null;

        let audioQueue = [];

        let isPlaying = false;

        let isTTSEnabled = true;



        const roleToModel = {

            'lawyer': 'llama-3.1-70b-versatile',



        };



        const roleToVoice = {

            'lawyer': 'VR6AewLTigWG4xSOukaG', // Mike



        };



        function selectPreset(presetName) {

            const modelSelect = document.getElementById('modelSelect');

            const voiceSelect = document.getElementById('voiceSelect');

            

            // Update dropdowns

            modelSelect.value = roleToModel[presetName];

            voiceSelect.value = roleToVoice[presetName];

            

            // Clear previous messages

            const chatContainer = document.querySelector('.chat-container');

            chatContainer.innerHTML = '';

            

            // Send initial system message to set up the AI's role

            fetch('/init', {

                method: 'POST',

                headers: {

                    'Content-Type': 'application/json',

                },

                body: JSON.stringify({

                    role: presetName,

                    sessionId: 'default-session'

                })

            })

            .then(response => response.json())

            .then(data => {

                if (data.message) {

                    addMessage(data.message, 'bot');

                    if (isTTSEnabled && data.audioChunks) {

                        playAudioSequence(data.audioChunks);

                    }

                }

            })

            .catch(error => {

                console.error('Error:', error);

                addMessage('Sorry, there was an error initializing the AI role.', 'bot');

            });

        }



        async function sendSystemMessage(presetName) {

            try {

                const response = await fetch('http://localhost:3000/chat', {

                    method: 'POST',

                    headers: {

                        'Content-Type': 'application/json',

                    },

                    body: JSON.stringify({

                        message: 'system:' + presetName,

                        sessionId: 'default-session',

                        model: modelSelect.value,

                        voiceId: voiceSelect.value,

                        selectedRole: modelSelect.options[modelSelect.selectedIndex].text

                    })

                });



                if (response.ok) {

                    addMessage("I'm now in my new role. How can I help you?", 'bot');

                }

            } catch (error) {

                console.error('Error setting system prompt:', error);

            }

        }



        // Initialize UI elements

        const messageInput = document.getElementById('messageInput');

        const sendButton = document.getElementById('sendButton');

        const chatContainer = document.getElementById('chatContainer');

        const modelSelect = document.getElementById('modelSelect');

        const voiceSelect = document.getElementById('voiceSelect');

        const recordButton = document.getElementById('recordButton');

        const stopButton = document.getElementById('stopButton');

        const stopAudioButton = document.getElementById('stopAudioButton');



        function addTypingIndicator() {

            const typingDiv = document.createElement('div');

            typingDiv.className = 'message bot-message typing-indicator';

            typingDiv.id = 'typingIndicator';

            for (let i = 0; i < 3; i++) {

                const dot = document.createElement('div');

                dot.className = 'typing-dot';

                typingDiv.appendChild(dot);

            }

            chatContainer.appendChild(typingDiv);

            chatContainer.scrollTop = chatContainer.scrollHeight;

        }



        function removeTypingIndicator() {

            const typingDiv = document.getElementById('typingIndicator');

            if (typingDiv) {

                typingDiv.remove();

            }

        }



        async function startRecording() {

            if (!isRecording) {

                try {

                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

                    mediaRecorder = new MediaRecorder(stream);

                    audioChunks = [];



                    mediaRecorder.ondataavailable = (event) => {

                        audioChunks.push(event.data);

                    };



                    mediaRecorder.onstop = async () => {

                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });

                        await sendAudioMessage(audioBlob);

                    };



                    mediaRecorder.start();

                    isRecording = true;

                    recordButton.classList.add('recording');

                    stopButton.style.display = 'flex';

                } catch (err) {

                    console.error('Error accessing microphone:', err);

                    addMessage('Error accessing microphone. Please check your permissions.', 'bot');

                }

            }

        }



        function stopRecording() {

            if (isRecording) {

                mediaRecorder.stop();

                isRecording = false;

                recordButton.classList.remove('recording');

                stopButton.style.display = 'none';

            }

        }



        function stopAudio() {

            if (currentAudio) {

                currentAudio.pause();

                currentAudio = null;

            }

            audioQueue = [];

            isPlaying = false;

            stopAudioButton.style.display = 'none';

        }



        async function playNextInQueue() {

            if (audioQueue.length === 0 || isPlaying) return;

            

            isPlaying = true;

            const audioUrl = audioQueue.shift();

            currentAudio = new Audio(audioUrl);

            

            currentAudio.onended = () => {

                isPlaying = false;

                playNextInQueue();

            };



            try {

                await currentAudio.play();

                stopAudioButton.style.display = 'flex';

            } catch (error) {

                console.error('Error playing audio:', error);

                isPlaying = false;

                playNextInQueue();

            }

        }



        async function sendAudioMessage(audioBlob) {

            const formData = new FormData();

            formData.append('audio', audioBlob);

            

            try {

                const response = await fetch('http://localhost:3000/transcribe', {

                    method: 'POST',

                    body: formData

                });

                

                const data = await response.json();

                if (data.text) {

                    addMessage(data.text, 'user');

                    sendMessage(data.text);

                }

            } catch (error) {

                console.error('Error transcribing audio:', error);

                addMessage('Error processing audio message.', 'bot');

            }

        }



        // Play audio function

        function playAudio(audioUrl) {

            if (!audioUrl) return;

            

            const audio = new Audio(audioUrl);

            audio.onerror = (e) => {

                console.error('Audio playback error:', e);

            };

            

            audio.play().catch(error => {

                console.error('Error playing audio:', error);

            });

        }



        async function sendMessage(text) {

            if (!text) return;



            // Clear input and disable send button

            messageInput.value = '';

            sendButton.disabled = true;

            

            // Add user message to chat

            addMessage(text, 'user');

            

            // Show typing indicator

            addTypingIndicator();



            try {

                const selectedRole = document.getElementById('modelSelect').value;

                const response = await fetch('/chat', {

                    method: 'POST',

                    headers: {

                        'Content-Type': 'application/json'

                    },

                    body: JSON.stringify({

                        message: text,

                        sessionId: 'session-' + Date.now(),

                        selectedRole: selectedRole,

                        ttsEnabled: document.getElementById('ttsToggle').checked,

                        voiceId: document.getElementById('voiceSelect').value,

                        voiceSettings: {

                            stability: 0.5,

                            similarity_boost: 0.5

                        }

                    })

                });



                // Remove typing indicator

                removeTypingIndicator();



                if (!response.ok) {

                    const errorData = await response.json();

                    let errorMessage = errorData.error || 'An error occurred';

                    

                    if (response.status === 429) {

                        errorMessage += ' Please wait a moment before trying again.';

                        setTimeout(() => {

                            sendButton.disabled = false;

                        }, 60000);

                    } else {

                        sendButton.disabled = false;

                    }

                    

                    addMessage(errorMessage, 'error');

                    return;

                }



                const data = await response.json();

                sendButton.disabled = false;

                

                // Add bot response to chat

                if (data.reply) {

                    addMessage(data.reply, 'assistant');

                    

                    // Play audio if available

                    if (data.audioUrl) {

                        playAudio(data.audioUrl);

                    }

                }

            } catch (error) {

                console.error('Error:', error);

                removeTypingIndicator();

                sendButton.disabled = false;

                addMessage('Sorry, I encountered an error. Please try again.', 'error');

            }

        }



        function addMessage(text, sender) {

            const chatContainer = document.querySelector('.chat-container');

            const messageDiv = document.createElement('div');

            messageDiv.classList.add('message');

            messageDiv.classList.add(sender === 'user' ? 'user-message' : sender === 'assistant' ? 'bot-message' : 'error-message');

            messageDiv.textContent = text;

            chatContainer.appendChild(messageDiv);

            chatContainer.scrollTop = chatContainer.scrollHeight;

        }



        // Event Listeners

        messageInput.addEventListener('keypress', (e) => {

            if (e.key === 'Enter' && messageInput.value.trim()) {

                const text = messageInput.value.trim();

                sendMessage(text);

            }

        });



        sendButton.addEventListener('click', () => {

            const text = messageInput.value.trim();

            if (text) {

                sendMessage(text);

            }

        });



        recordButton.addEventListener('click', startRecording);

        stopButton.addEventListener('click', () => {

            stopRecording();

            stopAudio();

        });

        stopAudioButton.addEventListener('click', stopAudio);



        // Update voice based on selected AI

        function updateVoiceBasedOnRole(selectedRole) {

            const voiceSelect = document.getElementById('voiceSelect');

            const maleVoice = voiceSelect.querySelector('option[data-gender="male"]');

            const femaleVoice = voiceSelect.querySelector('option[data-gender="female"]');

            

            // Set voice based on the AI's gender

            if (selectedRole.includes('Dr. Sarah Chen') || selectedRole.includes('Isabella Martinez')) {

                femaleVoice.selected = true;

            } else {

                maleVoice.selected = true;

            }

        }



        // Add change event listener to model select

        document.getElementById('modelSelect').addEventListener('change', function() {

            const selectedRole = this.options[this.selectedIndex].text;

            updateVoiceBasedOnRole(selectedRole);

        });



        // Advanced Settings Toggle

        document.querySelector('.advanced-settings-header').addEventListener('click', function() {

            const content = document.querySelector('.advanced-settings-content');

            content.classList.toggle('show');

        });



        // TTS Toggle functionality

        document.getElementById('ttsToggle').addEventListener('change', function() {

            isTTSEnabled = this.checked;

        });



        // Welcome message

        setTimeout(() => {

            addMessage("Hello! How can I assist you today?", 'bot');

        }, 1000);

    </script>

</body>

</html>

